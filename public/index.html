<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Choice Insurance Agency - Health, Life & Medicare - Choice Insurance</title>
    
    <!-- Auto-Documentation Generator -->
    <script src="/auto-docs.js"></script>
    
    <!-- Calendly badge widget begin -->
    <link href="https://assets.calendly.com/assets/external/widget.css" rel="stylesheet">
    <script src="https://assets.calendly.com/assets/external/widget.js" type="text/javascript" async></script>
    <script type="text/javascript">
      window.onload = function() { 
        Calendly.initBadgeWidget({ 
          url: 'https://calendly.com/choiceinsurancehub', 
          text: 'Schedule time with me', 
          color: '#42615a', 
          textColor: '#dd8b66', 
          branding: true 
        }); 
      }
    </script>
    <!-- Calendly badge widget end -->
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
    
    <!-- Enhanced Service Worker Registration with Multiple Update Detection Methods -->
    <script>
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/sw.js').then(reg => {
          console.log('Service Worker registered');
          
          // Generate auto-documentation
          if (typeof generateAutoDocs === 'function') {
            const docs = generateAutoDocs();
            console.log('Auto-Documentation:', docs);
          }
          
          // Listen for messages from service worker
          navigator.serviceWorker.addEventListener('message', event => {
            if (event.data && event.data.type === 'NEW_VERSION_AVAILABLE') {
              console.log('New version detected!');
              if (confirm('A new version of the website is available with the latest updates. Would you like to refresh to get the newest features?')) {
                window.location.reload();
              }
            }
          });
          
          // Check for waiting service worker
          if (reg.waiting) {
            console.log('New version waiting');
            if (confirm('A new version is ready. Would you like to refresh to get the latest updates?')) {
              reg.waiting.postMessage({ type: 'SKIP_WAITING' });
              window.location.reload();
            }
          }
          
          // Listen for new service worker installations
          reg.onupdatefound = () => {
            const installingWorker = reg.installing;
            installingWorker.onstatechange = () => {
              if (installingWorker.state === 'installed') {
                if (navigator.serviceWorker.controller) {
                  console.log('New version installed');
                  if (confirm('A new version has been installed. Would you like to refresh to get the latest updates?')) {
                    installingWorker.postMessage({ type: 'SKIP_WAITING' });
                    window.location.reload();
                  }
                }
              }
            };
          };
          
          // Periodic update checking from the main thread
          setInterval(() => {
            reg.update();
          }, 60000); // Check every minute
          
        }).catch(err => {
          console.log('Service Worker registration failed:', err);
        });
      }
    </script>
  </body>
</html>
