import { screen } from '@testing-library/react';
import { DayPickerProps } from 'DayPicker';

import { customRender } from 'test/render';
import {
  getMonthCaption,
  getMonthDropdown,
  getNextButton,
  getPrevButton,
  getYearDropdown,
  queryNextButton,
  queryPrevButton
} from 'test/selectors';
import { freezeBeforeAll } from 'test/utils';

import { CustomComponents } from 'types/DayPickerBase';

import { Caption, CaptionProps } from './Caption';

const today = new Date(2021, 8);

freezeBeforeAll(today);

function setup(props: CaptionProps, dayPickerProps?: DayPickerProps) {
  customRender(<Caption {...props} />, dayPickerProps);
}

describe(&apos;when navigation is disabled&apos;, () => {
  const props = { displayMonth: today };
  const dayPickerProps = { disableNavigation: true };
  beforeEach(() => setup(props, dayPickerProps));
  test(&apos;should display the caption label&apos;, () => {
    expect(getMonthCaption()).toHaveTextContent(&apos;September 2021&apos;);
  });
  test(&apos;should not render the navigation&apos;, () => {
    expect(queryPrevButton()).toBeNull();
    expect(queryNextButton()).toBeNull();
  });
});

describe(&apos;when using a custom CaptionLabel component&apos;, () => {
  const components: CustomComponents = {
    CaptionLabel: () => <>custom label foo</>
  };
  const props = { displayMonth: today };
  beforeEach(() => {
    setup(props, { components });
  });
  test(&apos;it should render the custom component instead&apos;, () => {
    expect(screen.getByText(&apos;custom label foo&apos;)).toBeInTheDocument();
  });
});

describe(&apos;when the caption layout is &quot;dropdown&quot;&apos;, () => {
  const dayPickerProps: DayPickerProps = {
    captionLayout: &apos;dropdown&apos;,
    fromYear: 2020,
    toYear: 2025
  };
  const props = { displayMonth: today };
  beforeEach(() => {
    setup(props, dayPickerProps);
  });
  test(&apos;should render the month drop-down&apos;, () => {
    expect(getMonthDropdown()).toBeInTheDocument();
  });
  test(&apos;should render the year drop-down&apos;, () => {
    expect(getYearDropdown()).toBeInTheDocument();
  });
});

describe(&apos;when the caption layout is &quot;buttons&quot;&apos;, () => {
  const dayPickerProps: DayPickerProps = {
    captionLayout: &apos;buttons&apos;
  };
  test(&apos;should render the next month button&apos;, () => {
    customRender(<Caption displayMonth={today} />, dayPickerProps);
    expect(getNextButton()).toBeInTheDocument();
  });
  test(&apos;should render the previous month button&apos;, () => {
    customRender(<Caption displayMonth={today} />, dayPickerProps);
    expect(getPrevButton()).toBeInTheDocument();
  });
});

describe('when the caption layout is "dropdown-buttons"', () => {
  const dayPickerProps: DayPickerProps = {
    captionLayout: 'dropdown-buttons',
    fromYear: 2020,
    toYear: 2025
  };
  const props = { displayMonth: today };
  beforeEach(() => {
    setup(props, dayPickerProps);
  });
  test('should render the month drop-down', () => {
    expect(getMonthDropdown()).toBeInTheDocument();
  });
  test('should render the year drop-down', () => {
    expect(getYearDropdown()).toBeInTheDocument();
  });
  test('should render the next month button', () => {
    expect(getNextButton()).toBeInTheDocument();
  });
  test('should render the previous month button', () => {
    expect(getPrevButton()).toBeInTheDocument();
  });
});
