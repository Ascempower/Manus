/**
 * @fileoverview Options configuration for optionator.
 * @author George Zahariev
 */

"use strict";

//------------------------------------------------------------------------------
// Requirements
//------------------------------------------------------------------------------

const optionator = require("optionator");

//------------------------------------------------------------------------------
// Typedefs
//------------------------------------------------------------------------------

/**
 * The options object parsed by Optionator.
 * @typedef {Object} ParsedCLIOptions
 * @property {boolean} cache Only check changed files
 * @property {string} cacheFile Path to the cache file. Deprecated: use --cache-location
 * @property {string} [cacheLocation] Path to the cache file or directory
 * @property {"metadata" | "content"} cacheStrategy Strategy to use for detecting changed files in the cache
 * @property {boolean} [color] Force enabling/disabling of color
 * @property {string} [config] Use this configuration, overriding .eslintrc.* config options if present
 * @property {boolean} debug Output debugging information
 * @property {string[]} [env] Specify environments
 * @property {boolean} envInfo Output execution environment information
 * @property {boolean} errorOnUnmatchedPattern Prevent errors when pattern is unmatched
 * @property {boolean} eslintrc Disable use of configuration from .eslintrc.*
 * @property {string[]} [ext] Specify JavaScript file extensions
 * @property {string[]} [flag] Feature flags
 * @property {boolean} fix Automatically fix problems
 * @property {boolean} fixDryRun Automatically fix problems without saving the changes to the file system
 * @property {("directive" | "problem" | "suggestion" | "layout")[]} [fixType] Specify the types of fixes to apply (directive, problem, suggestion, layout)
 * @property {string} format Use a specific output format
 * @property {string[]} [global] Define global variables
 * @property {boolean} [help] Show help
 * @property {boolean} ignore Disable use of ignore files and patterns
 * @property {string} [ignorePath] Specify path of ignore file
 * @property {string[]} [ignorePattern] Patterns of files to ignore. In eslintrc mode, these are in addition to `.eslintignore`
 * @property {boolean} init Run config initialization wizard
 * @property {boolean} inlineConfig Prevent comments from changing config or rules
 * @property {number} maxWarnings Number of warnings to trigger nonzero exit code
 * @property {string} [outputFile] Specify file to write report to
 * @property {string} [parser] Specify the parser to be used
 * @property {Object} [parserOptions] Specify parser options
 * @property {string[]} [plugin] Specify plugins
 * @property {string} [printConfig] Print the configuration for the given file
 * @property {boolean | undefined} reportUnusedDisableDirectives Adds reported errors for unused eslint-disable and eslint-enable directives
 * @property {string | undefined} reportUnusedDisableDirectivesSeverity A severity string indicating if and how unused disable and enable directives should be tracked and reported.
 * @property {string} [resolvePluginsRelativeTo] A folder where plugins should be resolved from, CWD by default
 * @property {Object} [rule] Specify rules
 * @property {string[]} [rulesdir] Load additional rules from this directory. Deprecated: Use rules from plugins
 * @property {boolean} stdin Lint code provided on <STDIN>
 * @property {string} [stdinFilename] Specify filename to process STDIN as
 * @property {boolean} quiet Report errors only
 * @property {boolean} [version] Output the version number
 * @property {boolean} warnIgnored Show warnings when the file list includes ignored files
 * @property {boolean} [passOnNoPatterns=false] When set to true, missing patterns cause
 *      the linting operation to short circuit and not report any failures.
 * @property {string[]} _ Positional filenames or patterns
 * @property {boolean} [stats] Report additional statistics
 * @property {boolean} [suppressAll] Suppress all error violations
 * @property {string[]} [suppressRule] Suppress specific rules
 * @property {string} [suppressionsLocation] Path to the suppressions file or directory
 * @property {boolean} [pruneSuppressions] Prune unused suppressions
 * @property {boolean} [passOnUnprunedSuppressions] Ignore unused suppressions
 */

//------------------------------------------------------------------------------
// Initialization and Public Interface
//------------------------------------------------------------------------------

// exports &quot;parse(args)&quot;, &quot;generateHelp()&quot;, and &quot;generateHelpForOption(optionName)&quot;

/**
 * Creates the CLI options for ESLint.
 * @param {boolean} usingFlatConfig Indicates if flat config is being used.
 * @returns {Object} The optionator instance.
 */
module.exports = function (usingFlatConfig) {
	let lookupFlag;

	if (usingFlatConfig) {
		lookupFlag = {
			option: &quot;config-lookup&quot;,
			type: &quot;Boolean&quot;,
			default: &quot;true&quot;,
			description: &quot;Disable look up for eslint.config.js&quot;,
		};
	} else {
		lookupFlag = {
			option: &quot;eslintrc&quot;,
			type: &quot;Boolean&quot;,
			default: &quot;true&quot;,
			description: &quot;Disable use of configuration from .eslintrc.*&quot;,
		};
	}

	let envFlag;

	if (!usingFlatConfig) {
		envFlag = {
			option: &quot;env&quot;,
			type: &quot;[String]&quot;,
			description: &quot;Specify environments&quot;,
		};
	}

	let inspectConfigFlag;

	if (usingFlatConfig) {
		inspectConfigFlag = {
			option: &quot;inspect-config&quot;,
			type: &quot;Boolean&quot;,
			description:
				&quot;Open the config inspector with the current configuration&quot;,
		};
	}

	let extFlag;

	if (!usingFlatConfig) {
		extFlag = {
			option: &quot;ext&quot;,
			type: &quot;[String]&quot;,
			description: &quot;Specify JavaScript file extensions&quot;,
		};
	} else {
		extFlag = {
			option: &quot;ext&quot;,
			type: &quot;[String]&quot;,
			description: &quot;Specify additional file extensions to lint&quot;,
		};
	}

	let resolvePluginsFlag;

	if (!usingFlatConfig) {
		resolvePluginsFlag = {
			option: &quot;resolve-plugins-relative-to&quot;,
			type: &quot;path::String&quot;,
			description:
				&quot;A folder where plugins should be resolved from, CWD by default&quot;,
		};
	}

	let rulesDirFlag;

	if (!usingFlatConfig) {
		rulesDirFlag = {
			option: &quot;rulesdir&quot;,
			type: &quot;[path::String]&quot;,
			description:
				&quot;Load additional rules from this directory. Deprecated: Use rules from plugins&quot;,
		};
	}

	let ignorePathFlag;

	if (!usingFlatConfig) {
		ignorePathFlag = {
			option: &quot;ignore-path&quot;,
			type: &quot;path::String&quot;,
			description: &quot;Specify path of ignore file&quot;,
		};
	}

	let statsFlag;

	if (usingFlatConfig) {
		statsFlag = {
			option: &quot;stats&quot;,
			type: &quot;Boolean&quot;,
			default: &quot;false&quot;,
			description: &quot;Add statistics to the lint report&quot;,
		};
	}

	let warnIgnoredFlag;

	if (usingFlatConfig) {
		warnIgnoredFlag = {
			option: &quot;warn-ignored&quot;,
			type: &quot;Boolean&quot;,
			default: &quot;true&quot;,
			description:
				&quot;Suppress warnings when the file list includes ignored files&quot;,
		};
	}

	let flagFlag;

	if (usingFlatConfig) {
		flagFlag = {
			option: &quot;flag&quot;,
			type: &quot;[String]&quot;,
			description: &quot;Enable a feature flag&quot;,
		};
	}

	let reportUnusedInlineConfigsFlag;

	if (usingFlatConfig) {
		reportUnusedInlineConfigsFlag = {
			option: &quot;report-unused-inline-configs&quot;,
			type: &quot;String&quot;,
			default: void 0,
			description:
				&quot;Adds reported errors for unused eslint inline config comments&quot;,
			enum: [&quot;off&quot;, &quot;warn&quot;, &quot;error&quot;, &quot;0&quot;, &quot;1&quot;, &quot;2&quot;],
		};
	}

	let mcpFlag;

	if (usingFlatConfig) {
		mcpFlag = {
			option: &quot;mcp&quot;,
			type: &quot;Boolean&quot;,
			description: &quot;Start the ESLint MCP server&quot;,
		};
	}

	return optionator({
		prepend: &quot;eslint [options] file.js [file.js] [dir]&quot;,
		defaults: {
			concatRepeatedArrays: true,
			mergeRepeatedObjects: true,
		},
		options: [
			{
				heading: &quot;Basic configuration&quot;,
			},
			lookupFlag,
			{
				option: &quot;config&quot;,
				alias: &quot;c&quot;,
				type: &quot;path::String&quot;,
				description: usingFlatConfig
					? &quot;Use this configuration instead of eslint.config.js, eslint.config.mjs, or eslint.config.cjs&quot;
					: &quot;Use this configuration, overriding .eslintrc.* config options if present&quot;,
			},
			inspectConfigFlag,
			envFlag,
			extFlag,
			{
				option: &quot;global&quot;,
				type: &quot;[String]&quot;,
				description: &quot;Define global variables&quot;,
			},
			{
				option: &quot;parser&quot;,
				type: &quot;String&quot;,
				description: &quot;Specify the parser to be used&quot;,
			},
			{
				option: &quot;parser-options&quot;,
				type: &quot;Object&quot;,
				description: &quot;Specify parser options&quot;,
			},
			resolvePluginsFlag,
			{
				heading: &quot;Specify Rules and Plugins&quot;,
			},
			{
				option: &quot;plugin&quot;,
				type: &quot;[String]&quot;,
				description: &quot;Specify plugins&quot;,
			},
			{
				option: &quot;rule&quot;,
				type: &quot;Object&quot;,
				description: &quot;Specify rules&quot;,
			},
			rulesDirFlag,
			{
				heading: &quot;Fix Problems&quot;,
			},
			{
				option: &quot;fix&quot;,
				type: &quot;Boolean&quot;,
				default: false,
				description: &quot;Automatically fix problems&quot;,
			},
			{
				option: &quot;fix-dry-run&quot;,
				type: &quot;Boolean&quot;,
				default: false,
				description:
					&quot;Automatically fix problems without saving the changes to the file system&quot;,
			},
			{
				option: &quot;fix-type&quot;,
				type: &quot;Array&quot;,
				description:
					&quot;Specify the types of fixes to apply (directive, problem, suggestion, layout)&quot;,
			},
			{
				heading: &quot;Ignore Files&quot;,
			},
			ignorePathFlag,
			{
				option: &quot;ignore&quot;,
				type: &quot;Boolean&quot;,
				default: &quot;true&quot;,
				description: &quot;Disable use of ignore files and patterns&quot;,
			},
			{
				option: &quot;ignore-pattern&quot;,
				type: &quot;[String]&quot;,
				description: `Patterns of files to ignore${usingFlatConfig ? &quot;&quot; : &quot; (in addition to those in .eslintignore)&quot;}`,
				concatRepeatedArrays: [
					true,
					{
						oneValuePerFlag: true,
					},
				],
			},
			{
				heading: &quot;Use stdin&quot;,
			},
			{
				option: &quot;stdin&quot;,
				type: &quot;Boolean&quot;,
				default: &quot;false&quot;,
				description: &quot;Lint code provided on <STDIN>",
			},
			{
				option: "stdin-filename",
				type: "String",
				description: "Specify filename to process STDIN as",
			},
			{
				heading: "Handle Warnings",
			},
			{
				option: "quiet",
				type: "Boolean",
				default: "false",
				description: "Report errors only",
			},
			{
				option: "max-warnings",
				type: "Int",
				default: "-1",
				description: "Number of warnings to trigger nonzero exit code",
			},
			{
				heading: "Output",
			},
			{
				option: "output-file",
				alias: "o",
				type: "path::String",
				description: "Specify file to write report to",
			},
			{
				option: "format",
				alias: "f",
				type: "String",
				default: "stylish",
				description: "Use a specific output format",
			},
			{
				option: "color",
				type: "Boolean",
				alias: "no-color",
				description: "Force enabling/disabling of color",
			},
			{
				heading: "Inline configuration comments",
			},
			{
				option: "inline-config",
				type: "Boolean",
				default: "true",
				description: "Prevent comments from changing config or rules",
			},
			{
				option: "report-unused-disable-directives",
				type: "Boolean",
				default: void 0,
				description:
					"Adds reported errors for unused eslint-disable and eslint-enable directives",
			},
			{
				option: "report-unused-disable-directives-severity",
				type: "String",
				default: void 0,
				description:
					"Chooses severity level for reporting unused eslint-disable and eslint-enable directives",
				enum: ["off", "warn", "error", "0", "1", "2"],
			},
			reportUnusedInlineConfigsFlag,
			{
				heading: "Caching",
			},
			{
				option: "cache",
				type: "Boolean",
				default: "false",
				description: "Only check changed files",
			},
			{
				option: "cache-file",
				type: "path::String",
				default: ".eslintcache",
				description:
					"Path to the cache file. Deprecated: use --cache-location",
			},
			{
				option: "cache-location",
				type: "path::String",
				description: "Path to the cache file or directory",
			},
			{
				option: "cache-strategy",
				dependsOn: ["cache"],
				type: "String",
				default: "metadata",
				enum: ["metadata", "content"],
				description:
					"Strategy to use for detecting changed files in the cache",
			},
			{
				heading: "Suppressing Violations",
			},
			{
				option: "suppress-all",
				type: "Boolean",
				default: "false",
				description: "Suppress all violations",
			},
			{
				option: "suppress-rule",
				type: "[String]",
				description: "Suppress specific rules",
			},
			{
				option: "suppressions-location",
				type: "path::String",
				description: "Specify the location of the suppressions file",
			},
			{
				option: "prune-suppressions",
				type: "Boolean",
				default: "false",
				description: "Prune unused suppressions",
			},
			{
				option: "pass-on-unpruned-suppressions",
				type: "Boolean",
				default: "false",
				description: "Ignore unused suppressions",
			},
			{
				heading: "Miscellaneous",
			},
			{
				option: "init",
				type: "Boolean",
				default: "false",
				description: "Run config initialization wizard",
			},
			{
				option: "env-info",
				type: "Boolean",
				default: "false",
				description: "Output execution environment information",
			},
			{
				option: "error-on-unmatched-pattern",
				type: "Boolean",
				default: "true",
				description: "Prevent errors when pattern is unmatched",
			},
			{
				option: "exit-on-fatal-error",
				type: "Boolean",
				default: "false",
				description: "Exit with exit code 2 in case of fatal error",
			},
			warnIgnoredFlag,
			{
				option: "pass-on-no-patterns",
				type: "Boolean",
				default: false,
				description:
					"Exit with exit code 0 in case no file patterns are passed",
			},
			{
				option: "debug",
				type: "Boolean",
				default: false,
				description: "Output debugging information",
			},
			{
				option: "help",
				alias: "h",
				type: "Boolean",
				description: "Show help",
			},
			{
				option: "version",
				alias: "v",
				type: "Boolean",
				description: "Output the version number",
			},
			{
				option: "print-config",
				type: "path::String",
				description: "Print the configuration for the given file",
			},
			statsFlag,
			flagFlag,
			mcpFlag,
		].filter(value => !!value),
	});
};
